From 29d008a2063ce3eea8dd48281a02d28ecffb3f62 Mon Sep 17 00:00:00 2001
From: Ryota MIBU <r-mibu@cq.jp.nec.com>
Date: Sat, 2 Jun 2012 23:01:13 +0900
Subject: [PATCH 1/2] support Quantum NEC OpenFlow Plugin

---
 stack.sh |   23 +++++++++++++++++++++++
 stackrc  |    6 +++---
 2 files changed, 26 insertions(+), 3 deletions(-)

diff --git a/stack.sh b/stack.sh
index 8a93608..ef3a930 100755
--- a/stack.sh
+++ b/stack.sh
@@ -644,6 +644,10 @@ fi
 if is_service_enabled q-svc; then
     # quantum
     git_clone $QUANTUM_REPO $QUANTUM_DIR $QUANTUM_BRANCH
+    if [[ "$Q_PLUGIN" = "nec" ]]; then
+        git_clone $NEC_PLUGIN_REPO $NEC_PLUGIN_DIR $NEC_PLUGIN_BRANCH
+        cp -r $NEC_PLUGIN_DIR/quantum/* $QUANTUM_DIR/
+    fi
 fi
 if is_service_enabled m-svc; then
     # melange
@@ -939,6 +943,25 @@ if is_service_enabled q-svc; then
         # Make sure we're using the openvswitch plugin
         sudo sed -i -e "s/^provider =.*$/provider = quantum.plugins.openvswitch.ovs_quantum_plugin.OVSQuantumPlugin/g" $QUANTUM_PLUGIN_INI_FILE
     fi
+    if [[ "$Q_PLUGIN" = "nec" ]]; then
+        # Create database for the plugin/agent
+        if is_service_enabled mysql; then
+            mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -e 'DROP DATABASE IF EXISTS quantum;'
+            mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -e 'CREATE DATABASE IF NOT EXISTS quantum CHARACTER SET utf8;'
+        else
+            echo "mysql must be enabled in order to use the $Q_PLUGIN Quantum plugin."
+            exit 1
+        fi
+        QUANTUM_PLUGIN_INI_FILE=$QUANTUM_CONF_DIR/plugins.ini
+        if [[ -e $QUANTUM_DIR/etc/plugins.ini ]]; then
+            sudo mv $QUANTUM_DIR/etc/plugins.ini $QUANTUM_PLUGIN_INI_FILE
+        fi
+        sudo sed -i -e "s/^provider =.*$/provider = quantum.plugins.nec.nec_plugin.NECPlugin/g" $QUANTUM_PLUGIN_INI_FILE
+        # Set up NEC Plugin
+        sudo sed -i -e "s/^user.*$/user = root/g" \
+                    -e "s/^pass.*$/pass = $MYSQL_PASSWORD/g" \
+                    $QUANTUM_DIR/etc/quantum/plugins/nec/nec.ini
+    fi
     if [[ -e $QUANTUM_DIR/etc/quantum.conf ]]; then
         sudo mv $QUANTUM_DIR/etc/quantum.conf $QUANTUM_CONF_DIR/quantum.conf
     fi
diff --git a/stackrc b/stackrc
index 1ca3061..99b5db9 100644
--- a/stackrc
+++ b/stackrc
@@ -35,11 +35,11 @@ HORIZON_BRANCH=stable/essex
 
 # python client library to nova that horizon (and others) use
 NOVACLIENT_REPO=https://github.com/openstack/python-novaclient.git
-NOVACLIENT_BRANCH=master
+NOVACLIENT_BRANCH=2012.1
 
 # python keystone client library to nova that horizon uses
 KEYSTONECLIENT_REPO=https://github.com/openstack/python-keystoneclient
-KEYSTONECLIENT_BRANCH=master
+KEYSTONECLIENT_BRANCH=2012.1
 
 # quantum service
 QUANTUM_REPO=https://github.com/openstack/quantum
@@ -47,7 +47,7 @@ QUANTUM_BRANCH=stable/essex
 
 # quantum client
 QUANTUM_CLIENT_REPO=https://github.com/openstack/python-quantumclient
-QUANTUM_CLIENT_BRANCH=master
+QUANTUM_CLIENT_BRANCH=2012.1
 
 # Tempest test suite
 TEMPEST_REPO=https://github.com/openstack/tempest.git
-- 
1.7.9.5

